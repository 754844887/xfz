function BannerAdd(){this.addBannerBtn=$(".addBanner-btn"),this.count=1,this.action="show",this.bannerListGroup=$(".banner-list")}BannerAdd.prototype.listenCloseBtn=function(){var e=this;$(".banner-list").on("click",".close-btn",function(){var n=$(this),t=n.parent().parent().parent().parent(),i=n.data("bannerid");i?swal({title:"确定删除该轮播图吗？",text:"你将无法恢复该信息！",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定删除！",cancelButtonText:"取消删除！",closeOnConfirm:!1,closeOnCancel:!1},function(n){n?myajax.post({url:"/cms/banner_del/",data:{banner_id:i},success:function(n){console.log("deling---"),200===n.code&&window.location.reload()}}):window.location.reload()}):t.hide(),1<e.count&&(e.count-=1)})},BannerAdd.prototype.listenMinimizeBtn=function(){var t=this;$(".banner-list").on("click",".min-btn",function(){var n=$(this).parent().parent().siblings();"show"===t.action?(n.hide(),$("#banner-icon").removeClass("fa-minus").addClass("fa-plus"),t.action="hide"):"hide"===t.action&&(n.show(),$("#banner-icon").removeClass("fa-plus").addClass("fa-minus"),t.action="show")})},BannerAdd.prototype.listenAddBanner=function(){var t=this;t.addBannerBtn.click(function(){if(t.count<=6){var n=template("banner-item",{data:t.count});t.bannerListGroup.prepend(n),t.count+=1}})},BannerAdd.prototype.listenImageInput=function(){$(".banner-list").on("click",".image-input",function(){var i=$(this),e=i.siblings("#input-upload");e.click(),e.change(function(){var n=e[0].files[0],t=new FormData;t.append("file",n),myajax.post({url:"/cms/upload/",data:t,processData:!1,contentType:!1,success:function(n){if(200==n.code){var t=n.data.url;i.attr("src",t)}}})})})},BannerAdd.prototype.listenBannerSave=function(){$(".banner-list").on("click","#submin-btn",function(){var n=$(this),t=n.parent().siblings(".box-body").children(".banner-group"),i=t.children(".thumbnail-group").children(".image-input"),e=t.children(".thumbnail-input").children(".priority").children("#priority"),a=t.children(".thumbnail-input").children(".link").children("#link"),o="",r=n.attr("data-bannerid");if(r)o="/cms/banner_edit/";else o="/cms/banner_add/";if("/static/images/banner.png"===(s=i.attr("src")))var s="";var c=e.val(),l=a.val();myajax.post({url:o,data:{pk:r,priority:c,image_url:s,link_to:l},success:function(n){if(200===n.code)r?window.messageBox.show("轮播图编辑成功！"):window.messageBox.show("轮播图添加成功！"),window.location.reload();else{var t=n.message;if("string"==typeof t||t.constructor==String)window.messageBox.show(t);else for(var i in t){var e=t[i][0];window.messageBox.showError(e)}}}})})},BannerAdd.prototype.listenBannerList=function(){var o=this;myajax.get({url:"/cms/banner_list/",success:function(n){if(200===n.code)for(var t=n.data,i=0;i<t.length;i++){var e=t[i],a=template("banner-item",{banner:e});o.bannerListGroup.append(a)}}})},BannerAdd.prototype.run=function(){this.listenAddBanner(),this.listenCloseBtn(),this.listenMinimizeBtn(),this.listenImageInput(),this.listenBannerSave(),this.listenBannerList()},$(function(){(new BannerAdd).run()});